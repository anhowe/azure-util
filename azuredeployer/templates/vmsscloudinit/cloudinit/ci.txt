"customData": "[base64(concat('#cloud-config\n\nruncmd:\n- echo \"wait until there is an IPv4 address, occasionally the IPv6 shows up first, and it causes NFS to hang when IPv4 eventually shows up\"\n- r=60 && for i in $(seq 1 $r); do hostname -i | grep -Eo \"[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\" && break || [ $i == $r ] && break 0 || sleep 5; done\n- r=60 && for i in $(seq 1 $r); do apt-get update && break || [ $i == $r ] && break 0 || sleep 5; done\n- r=60 && for i in $(seq 1 $r); do apt-get install -y nfs-common && break || [ $i == $r ] && break 0 || sleep 5; done\n- mkdir -p ',variables('bootstrapBaseDir'),'\n- r=60 && for i in $(seq 1 $r); do mount -o \"hard,nointr,proto=tcp,mountproto=tcp,retry=30\" ',variables('bootstrapNFSIP'),':',variables('nfsExportPath'),' ',variables('bootstrapBaseDir'),' && break || [ $i == $r ] && break 0 || sleep 1; done \n- NFS_IP_CSV=\"',variables('nfsCommaSeparatedAddresses'),'\" NFS_PATH=\"',variables('nfsExportPath'),'\" BASE_DIR=\"',variables('nfsMountBaseDir'),'\" /bin/bash ',variables('bootstrapBaseDir'),'',variables('bootstrapScriptPath'),' 2>&1 | tee -a /var/log/bootstrap.log\n- umount ',variables('bootstrapBaseDir'),'\n- rmdir ',variables('bootstrapBaseDir'),''))]",
